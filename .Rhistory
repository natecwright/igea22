library(rgdal)
library(sf)
setwd('/Users/Oskar/Documents/UMass/IGEA/igea22/')
#group12 raw water data reading-in and normalization----
WS1_df = read_xlsx('Raw_water_data/12WS.xlsx')
#select and rename columns
WS1_clean_df=WS1_df%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 323)%>%
filter(Line <= 580)%>%
filter(Ignore == 0)
#create df for normalizing
WS1_stand_df=WS1_clean_df%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
#linear regressions
modelO = lm(formula = standardO ~ meanO, data = WS1_stand_df)
modelH = lm(formula = standardH ~ meanH, data = WS1_stand_df)
#create normalized df
WS1_norm_df=WS1_clean_df%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
#average isotope ratios and join with metadata----
WS1_avg_df = WS1_norm_df%>%
group_by(Identifier_1)%>%
summarize(avgO=mean(normO),avgH=mean(normH))
#join averages with metadata
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
by_dist_group=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=1000,distance_col='meters_apart')
#script to read in WS data
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(fuzzyjoin)
library(gmt)
library(rgdal)
library(sf)
setwd('/Users/Oskar/Documents/UMass/IGEA/igea22/')
#group3 raw water data
WS3_1 = read_xlsx('Raw_water_data/3WS.1.xlsx')
WS3_2= read_xlsx('Raw_water_data/3WS.2.xlsx')
View(WS3_1)
View(WS3_2)
View(WS1_df)
WS3_clean_df=WS3_1%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 160)%>%
filter(Line <= 255)%>%
filter(Ignore == 0)
WS3_clean=WS3_1%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 160)%>%
filter(Line <= 255)%>%
filter(Ignore == 0)
View(WS3_clean)
View(WS1_clean_df)
WS3_stand=WS3_clean%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
#linear regressions
modelO = lm(formula = standardO ~ meanO, data = WS3_stand)
modelH = lm(formula = standardH ~ meanH, data = WS3_stand)
View(WS3_stand)
WS3_norm=WS3_clean%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
View(WS3_norm)
by_dist_group=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=1000,distance_col='meters_apart')
by_dist_group=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=10000,distance_col='meters_apart')
by_dist_group=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=100000,distance_col='meters_apart')
View(metadata_df)
WS3_clean2=WS3_2%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 28)%>%
filter(Line <= 123)%>%
filter(Ignore == 0)
WS3_stand=rbind(WS3_clean1,WS3_clean2)%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
WS3_clean1=WS3_1%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 160)%>%
filter(Line <= 255)%>%
filter(Ignore == 0)
WS3_stand=rbind(WS3_clean1,WS3_clean2)%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
#linear regressions
modelO = lm(formula = standardO ~ meanO, data = WS3_stand)
modelH = lm(formula = standardH ~ meanH, data = WS3_stand)
#create normalized df
WS3_norm=WS3_clean%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
#average isotope ratios and join with metadata----
WS3_avg = WS3_norm%>%
group_by(Identifier_1)%>%
summarize(avgO=mean(normO),avgH=mean(normH))
View(WS3_avg)
View(WS3_norm)
View(WS3_stand)
WS3_norm=rbind(WS3_clean1,WS3_clean2)%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
#average isotope ratios and join with metadata----
WS3_avg = WS3_norm%>%
group_by(Identifier_1)%>%
summarize(avgO=mean(normO),avgH=mean(normH))
saveRDS(WS3_avg,'/Users/Oskar/Documents/UMass/IGEA/igea22/water_scripts/')
saveRDS(WS3_avg,'water_scripts/WS3_avg.rds')
WS3_avg=readRDS('water_scripts/WS3_avg.rds')
WS3_avg=readRDS('water_scripts/WS3_avg.rds')
WS_avg=rbind(WS1_avg_df,WS3_avg)
View(WS_avg)
View(WS_avg)
View(WS1_avg_df)
our_df = left_join(WS_avg,metadata_df,"Identifier_1")
View(our_df)
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
#filter for North Slope
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude < -149.4~"TOOK",
Longitude >= -149.4~"OKSR"))
precip_NS_df = precip_df%>%
filter(between(Latitude,68,69))
#join by coordinates----
LongLatToUTM<-function(x,y,zone){
xy <- data.frame(ID = 1:length(x), X = x, Y = y)
coordinates(xy) <- c("X", "Y")
proj4string(xy) <- CRS("+proj=longlat +datum=WGS84")
res <- spTransform(xy, CRS(paste("+proj=utm +zone=",zone," ellps=WGS84",sep='')))
res=st_as_sf(res)
return(data.frame(x=st_coordinates(res)[,1],y=st_coordinates(res)[,2]))}
ground_utm = ground_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
precip_utm = precip_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
by_time_precip=difference_left_join(our_df,precip_utm,by='doy',max_dist=365,distance_col='days_apart')
by_dist_group=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=100000,distance_col='meters_apart')
#script for group 1 and 2 WS data analysis
#libraries and wd----
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(fuzzyjoin)
library(gmt)
library(rgdal)
library(sf)
setwd('/Users/Oskar/Documents/UMass/IGEA/igea22/')
#group12 raw water data reading-in and normalization----
WS1_df = read_xlsx('Raw_water_data/12WS.xlsx')
#select and rename columns
WS1_clean_df=WS1_df%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 323)%>%
filter(Line <= 580)%>%
filter(Ignore == 0)
#create df for normalizing
WS1_stand_df=WS1_clean_df%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
#linear regressions
modelO = lm(formula = standardO ~ meanO, data = WS1_stand_df)
modelH = lm(formula = standardH ~ meanH, data = WS1_stand_df)
#create normalized df
WS1_norm_df=WS1_clean_df%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
#average isotope ratios and join with metadata----
WS1_avg_df = WS1_norm_df%>%
group_by(Identifier_1)%>%
summarize(avgO=mean(normO),avgH=mean(normH))
#combining groups 1, 2, and 3
WS3_avg=readRDS('water_scripts/WS3_avg.rds')
WS_avg=rbind(WS1_avg_df,WS3_avg)
#join averages with metadata
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
our_df = left_join(WS_avg,metadata_df,"Identifier_1")
#read in NEON data----
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
#filter for North Slope
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude < -149.4~"TOOK",
Longitude >= -149.4~"OKSR"))
precip_NS_df = precip_df%>%
filter(between(Latitude,68,69))
#join by coordinates----
LongLatToUTM<-function(x,y,zone){
xy <- data.frame(ID = 1:length(x), X = x, Y = y)
coordinates(xy) <- c("X", "Y")
proj4string(xy) <- CRS("+proj=longlat +datum=WGS84")
res <- spTransform(xy, CRS(paste("+proj=utm +zone=",zone," ellps=WGS84",sep='')))
res=st_as_sf(res)
return(data.frame(x=st_coordinates(res)[,1],y=st_coordinates(res)[,2]))}
ground_utm = ground_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
precip_utm = precip_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
by_time_precip=difference_left_join(our_df,precip_utm,by='doy',max_dist=365,distance_col='days_apart')
by_dist_group=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=100000,distance_col='meters_apart')
View(our_df)
by_time_precip=difference_left_join(our_df,precip_utm,by='doy',max_dist=365,distance_col='days_apart')%>%
mutate(w=1/'days_apart')
by_time_precip=difference_left_join(our_df,precip_utm,by='doy',max_dist=365,distance_col='days_apart')%>%
mutate(w=1/days_apart)
View(by_time_precip)
View(precip_utm)
View(ground_utm)
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
#read in NEON data----
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
#filter for North Slope
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude < -149.4~"TOOK",
Longitude >= -149.4~"OKSR"))
precip_NS_df = precip_df%>%
filter(between(Latitude,68,69))
#join by coordinates----
LongLatToUTM<-function(x,y,zone){
xy <- data.frame(ID = 1:length(x), X = x, Y = y)
coordinates(xy) <- c("X", "Y")
proj4string(xy) <- CRS("+proj=longlat +datum=WGS84")
res <- spTransform(xy, CRS(paste("+proj=utm +zone=",zone," ellps=WGS84",sep='')))
res=st_as_sf(res)
return(data.frame(x=st_coordinates(res)[,1],y=st_coordinates(res)[,2]))}
ground_utm = ground_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
precip_utm = precip_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
by_time_precip=difference_left_join(our_df,precip_utm,by='doy',max_dist=365,distance_col='days_apart')%>%
mutate(w=1/days_apart)
by_dist_group=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=100000,distance_col='meters_apart')
View(by_dist_group)
by_dist_ground=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=100000,distance_col='meters_apart')
#script for group 1 and 2 WS data analysis
#libraries and wd----
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(fuzzyjoin)
library(gmt)
library(rgdal)
library(sf)
setwd('/Users/Oskar/Documents/UMass/IGEA/igea22/')
#group12 raw water data reading-in and normalization----
WS1_df = read_xlsx('Raw_water_data/12WS.xlsx')
#select and rename columns
WS1_clean_df=WS1_df%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 323)%>%
filter(Line <= 580)%>%
filter(Ignore == 0)
#create df for normalizing
WS1_stand_df=WS1_clean_df%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
#linear regressions
modelO = lm(formula = standardO ~ meanO, data = WS1_stand_df)
modelH = lm(formula = standardH ~ meanH, data = WS1_stand_df)
#create normalized df
WS1_norm_df=WS1_clean_df%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
#average isotope ratios and join with metadata----
WS1_avg_df = WS1_norm_df%>%
group_by(Identifier_1)%>%
summarize(avgO=mean(normO),avgH=mean(normH))
#combining groups 1, 2, and 3
WS3_avg=readRDS('water_scripts/WS3_avg.rds')
WS_avg=rbind(WS1_avg_df,WS3_avg)
#join averages with metadata
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
#read in NEON data----
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
#filter for North Slope
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude < -149.4~"TOOK",
Longitude >= -149.4~"OKSR"))
precip_NS_df = precip_df%>%
filter(between(Latitude,68,69))
#join by coordinates----
LongLatToUTM<-function(x,y,zone){
xy <- data.frame(ID = 1:length(x), X = x, Y = y)
coordinates(xy) <- c("X", "Y")
proj4string(xy) <- CRS("+proj=longlat +datum=WGS84")
res <- spTransform(xy, CRS(paste("+proj=utm +zone=",zone," ellps=WGS84",sep='')))
res=st_as_sf(res)
return(data.frame(x=st_coordinates(res)[,1],y=st_coordinates(res)[,2]))}
ground_utm = ground_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
precip_utm = precip_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
by_time_precip=difference_left_join(our_df,precip_utm,by='doy',max_dist=365,distance_col='days_apart')%>%
mutate(w=1/days_apart)
by_dist_ground=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=100000,distance_col='meters_apart')
View(by_dist_ground)
#script for group 3 WS data analysis
#libraries and wd----
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(fuzzyjoin)
library(gmt)
library(rgdal)
library(sf)
setwd('/Users/Oskar/Documents/UMass/IGEA/igea22/')
WS3_1 = read_xlsx('Raw_water_data/3WS.1.xlsx')
WS3_2= read_xlsx('Raw_water_data/3WS.2.xlsx')
#mine
#clean up----
WS3_clean1=WS3_1%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 160)%>%
filter(Line <= 255)%>%
filter(Ignore == 0)
WS3_clean2=WS3_2%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 28)%>%
filter(Line <= 123)%>%
filter(Ignore == 0)
#create df for normalizing
WS3_stand=rbind(WS3_clean1,WS3_clean2)%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
#linear regressions
modelO = lm(formula = standardO ~ meanO, data = WS3_stand)
modelH = lm(formula = standardH ~ meanH, data = WS3_stand)
#create normalized df
WS3_norm=rbind(WS3_clean1,WS3_clean2)%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
#average isotope ratios and join with metadata----
WS3_avg = WS3_norm%>%
group_by(Identifier_1)%>%
summarize(avgO=mean(normO),avgH=mean(normH))
View(WS3_avg)
metadata3 = read_xlsx('Raw_water_data/3metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
metadata3 = read_xlsx('Raw_water_data/3metadata.xlsx')
View(metadata3)
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')
View(metadata_df)
metadata3 = read_xlsx('Raw_water_data/3metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))
metadata3 = read_xlsx('Raw_water_data/3metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))
metadata3 = read_xlsx('Raw_water_data/3metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
our3 = left_join(WS3_avg,metadata3,"Identifier_1")
saveRDS(WS3_avg,'water_scripts/our3.rds')
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
#combining groups 1, 2, and 3
our3=readRDS('water_scripts/our3.rds')
ours=rbind(WS1_avg_df,WS3_avg)
View(ours)
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
#filter for North Slope
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude < -149.4~"TOOK",
Longitude >= -149.4~"OKSR"))
precip_NS_df = precip_df%>%
filter(between(Latitude,68,69))
#join by coordinates----
LongLatToUTM<-function(x,y,zone){
xy <- data.frame(ID = 1:length(x), X = x, Y = y)
coordinates(xy) <- c("X", "Y")
proj4string(xy) <- CRS("+proj=longlat +datum=WGS84")
res <- spTransform(xy, CRS(paste("+proj=utm +zone=",zone," ellps=WGS84",sep='')))
res=st_as_sf(res)
return(data.frame(x=st_coordinates(res)[,1],y=st_coordinates(res)[,2]))}
ground_utm = ground_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
precip_utm = precip_NS_df%>%
mutate(LongLatToUTM(Longitude,Latitude,6))
by_time_precip=difference_left_join(our_df,precip_utm,by='doy',max_dist=365,distance_col='days_apart')%>%
mutate(w=1/days_apart)
by_dist_ground=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=100000,distance_col='meters_apart')
View(WS1_avg_df)
View(WS1_norm_df)
by_dist_ground=distance_left_join(our_df,ground_utm,by=c("x","y"),max_dist=100000,distance_col='meters_apart')%>%
group_by(Identifier_1)%>%
summarize(dist_ground=min(meters_apart))
