install.packages("dplyer")
install.packages(dplyer)
install.packages(Rtools)
install.packages("Rtools")
install.packages("dplyer")
install.packages("dplyr")
library("dlpyr")
library("dplyr")
install.packages("readxl")
library("readxl")
library("readxl")
data_in=read_xlsx(""C:\Users\Oskar\Documents\UMass\IGEA\Field Data 6_1 and forward.xlsx"")
data_in=read_xlsx("C:\Users\Oskar\Documents\UMass\IGEA\Field Data 6_1 and forward.xlsx)
data_in=read_xlsx("\Users\Oskar\Documents\UMass\IGEA\Field Data 6_1 and forward.xlsx)
source("~/.active-rstudio-document", echo=TRUE)
View(data_in)
View(data_in)
metadata_in=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx",sheet=3)
total_station_1=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx",sheet=1)
View(metadata_in)
joined_df=left_join(total_station_1,metadata_in,by="Reach")
joined_df=left_join(total_station_1,metadata_in,by="Reach")
data_in=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx")
metadata_in=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx",sheet=3)
joined_df=left_join(total_station_1,metadata_in,by="Reach")
view(joined_df)
View(joined_df)
View(data_in)
View(total_station_1)
View(joined_df)
install.packages("readxl")
data_in=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx")
library(readxl)
data_in=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx")
total_station_1=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx",sheet=1)
metadata_in=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx",sheet=3)
View(data_in)
View(total_station_1)
View(data_in)
View(data_in)
View(data_in)
joined_df=left_join(total_station_1,metadata_in,by="Reach")
install.packages("dplyr")
library(dplyr)
install.packages("readxl")
library(readxl)
total_station_1=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx",sheet=1)
metadata_in=read_xlsx("C:/Users/Oskar/Documents/UMass/IGEA/Field Data 6_1 and forward.xlsx",sheet=3)
joined_df=left_join(total_station_1,metadata_in,by="Reach")
View(joined_df)
filter(Reach=="") #by a specific reach
install.packages("readxl")
View(total_station_1)
View(metadata_in)
View(joined_df)
filter(Reach=="") #by a specific reach
filter(Reach=="") #by a specific reach
filter(Reach=="E7") #by a specific reach
filter(joined_df, Reach=="E7") #by a specific reach
filter(joined_df, Reach=="E7") #by a specific reach
filter(joined_df, "Reach"=="E7") #by a specific reach
#script for WS data analysis
#libraries and wd----
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(fuzzyjoin)
setwd('/Users/Oskar/Documents/UMass/IGEA/igea22/')
#group12 raw water data reading-in and normalization----
WS1_df = read_xlsx('Raw_water_data/12WS.xlsx')
#select and rename columns
WS1_clean_df=WS1_df%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 323)%>%
filter(Line <= 580)%>%
filter(Ignore == 0)
#create df for normalizing
WS1_stand_df=WS1_clean_df%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
#linear regressions
modelO = lm(formula = standardO ~ meanO, data = WS1_stand_df)
modelH = lm(formula = standardH ~ meanH, data = WS1_stand_df)
#create normalized df
WS1_norm_df=WS1_clean_df%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
#average isotope ratios and join with metadata----
WS1_avg_df = WS1_norm_df%>%
group_by(Identifier_1)%>%
summarize(avgO=mean(normO),avgH=mean(normH))
#join averages with metadata
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
View(our_df)
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))
View(ground_df)
ground_NS_df = ground_df%>%
filter(Latitude == 68:69)
ground_NS_df = ground_df%>%
filter(Latitude == (68:69))
View(ground_NS_df)
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(below(Longitude,149.4)~TOOK,
above(Longitude,149.4)~OKSR))
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude < 149.4~TOOK,
Longitude >= 149.4~OKSR))
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude < 149.4~"TOOK",
Longitude >= 149.4~"OKSR"))
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude < -149.4~"TOOK",
Longitude >= -149.4~"OKSR"))
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude >= -149.4~"TOOK",
Longitude < -149.4~"OKSR"))
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska", format = "%j"))%>%
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska")%>%
mutate(doy_ground=strftime(date_time, format = "%j")))
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy_ground=strftime(date_time, format = "%j"))
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska", format = "%j"))
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy_ground=strftime(date_time, format = "%j"))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy_precip=strftime(date_time, format = "%j"))
View(precip_df)
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude >= -149.4~"TOOK",
Longitude < -149.4~"OKSR"))
#join averages with metadata
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy_us=strftime(date_time, format = "%j"))
View(our_df)
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=strftime(date_time, format = "%j"))
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
#join our data with NEON data----
#read in NEON data
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=strftime(date_time, format = "%j"))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=strftime(date_time, format = "%j"))
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=strftime(date_time, format = "%S"))
View(metadata_df)
read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=strftime(date_time, format = "%j"))
print(n=20)
doy$metadata_df
metadata_df%doy
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=strftime(date_time, format = "%j"))
metadata_df%doy
doy$metadata_df
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=strftime(date_time, format = "%m"))
View(metadata_df)
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as_numeric(strftime(date_time, format = "%j")))
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=strftime(date_time, format = "%j"))%>%
transmute(doy=as.numeric(doy))
View(metadata_df)
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
#join our data with NEON data----
#read in NEON data
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
#filter for North Slope
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude >= -149.4~"TOOK",
Longitude < -149.4~"OKSR"))
#don't need: join by time within 2 weeks
by_time=difference_inner_join(our_df,ground_NS_df,by='doy',max_dist=14,distance_col='days_apart')
View(by_time)
View(ground_NS_df)
View(our_df)
View(ground_NS_df)
View(our_df)
View(ground_df)
View(ground_NS_df)
View(precip_df)
precip_NS_df = precip_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude >= -149.4~"TOOK",
Longitude < -149.4~"OKSR"))
View(precip_NS_df)
precip_NS_df = precip_df%>%
filter(between(Latitude,68,69))
by_time=difference_inner_join(our_df,precip_NS_df,by='doy',max_dist=365,distance_col='days_apart')
View(by_time)
by_time=difference_inner_join(our_df,precip_NS_df,by='doy',max_dist=365,distance_col='days_apart')%>%
mutate(weights=1/'doy')
View(our_df)
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")%>%
transmute('Easting'='Latitude')
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")%>%
transmute('Latitude'='Easting')
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")%>%
transmute('Latitude'=='Easting')
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")%>%
transmute(Latitude=Easting)
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
our_df = left_join(WS1_avg_df,metadata_df,Identifier_1)
#script for WS data analysis
#libraries and wd----
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(fuzzyjoin)
setwd('/Users/Oskar/Documents/UMass/IGEA/igea22/')
#group12 raw water data reading-in and normalization----
WS1_df = read_xlsx('Raw_water_data/12WS.xlsx')
#select and rename columns
WS1_clean_df=WS1_df%>%
select('Line', 'd(18_16)Mean', 'd(D_H)Mean', 'Ignore', 'Identifier_1', 'Identifier_2')%>%
rename("meanO"="d(18_16)Mean")%>%
rename("meanH"="d(D_H)Mean")%>%
filter(Line >= 323)%>%
filter(Line <= 580)%>%
filter(Ignore == 0)
#create df for normalizing
WS1_stand_df=WS1_clean_df%>%
filter(Identifier_2 == "standard")%>%
mutate(standardO=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~.3,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-20.6,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-29.6,))%>%
mutate(standardH=case_when(Identifier_1 == "Picarro zero 1 6_23_22" | Identifier_1 == "Picarro zero 2 6_23_22" | Identifier_1 == "Picarro zero 3 6_23_22"~1.8,
Identifier_1 == "Picarro mid 3 6_23_22" | Identifier_1 == "Picarro mid 2 6_23_22"| Identifier_1 == "Picarro mid 1 6_23_22"~-159,
Identifier_1 == "Picarro depl 3 6_23_22" | Identifier_1 == "Picarro depl 2 6_23_22"| Identifier_1 == "Picarro depl 1 6_23_22"~-235,))
#linear regressions
modelO = lm(formula = standardO ~ meanO, data = WS1_stand_df)
modelH = lm(formula = standardH ~ meanH, data = WS1_stand_df)
#create normalized df
WS1_norm_df=WS1_clean_df%>%
filter(Identifier_2=="sample")%>%
mutate(normO=modelO$coefficients[2]*meanO+modelO$coefficients[1])%>%
mutate(normH=modelH$coefficients[2]*meanH+modelH$coefficients[1])
#average isotope ratios and join with metadata----
WS1_avg_df = WS1_norm_df%>%
group_by(Identifier_1)%>%
summarize(avgO=mean(normO),avgH=mean(normH))
#join averages with metadata
metadata_df = read_xlsx('Raw_water_data/12metadata.xlsx')%>%
mutate(newtime = sapply(strsplit(as.character(Sample_Time), " "),"[",2))%>%
mutate(newdate = paste(Date, newtime, sep = " "))%>%
mutate(date_time=as.POSIXct(newdate,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
our_df = left_join(WS1_avg_df,metadata_df,"Identifier_1")
#join our data with NEON data----
#read in NEON data
ground_df = read_xlsx('Raw_water_data/NEON_ground_111622.xlsx')%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
precip_df = read_xlsx('Raw_water_data/NEON_precipitation.xlsx',sheet=2, skip=1)%>%
select('Latitude','Longitude','Elevation_mabsl','Sample_ID','Collection_Date','d2H','d18O')%>%
mutate(date_time=as.POSIXct(Collection_Date,tz="US/Alaska"))%>%
mutate(doy=as.numeric(strftime(date_time, format = "%j")))
#filter for North Slope
ground_NS_df = ground_df%>%
filter(between(Latitude,68,69))%>%
mutate(Site_ID=case_when(Longitude >= -149.4~"TOOK",
Longitude < -149.4~"OKSR"))
precip_NS_df = precip_df%>%
filter(between(Latitude,68,69))
install(gmt)
install.packages(gmt)
geodist(90,0, -90,0, "nm")
install.packages('gmt'')
geodist(90,0, -90,0, "nm")
#script for WS data analysis
#libraries and wd----
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(fuzzyjoin)
library(gmt)
setwd('/Users/Oskar/Documents/UMass/IGEA/igea22/')
library(dplyr)
library(readxl)
library(tidyr)
library(stringr)
library(fuzzyjoin)
library(gmt)
install.packages('gmt')
library(gmt)
by_dist=geodist(our_df$Latitude, our_df$Longitude, precip_NS_df$Latitude, precip_NS_df$Longitude)
